<?xml version="1.0"?>
<ruleset name="Linchpin" namespace="Linchpin\CodingStandards">
	<description>Linchpin coding standards.</description>

	<!-- Set the memory limit to 512M. -->
	<ini name="memory_limit" value="512M"/>

	<!-- Whenever possible, cache the scan results and re-use those for unchanged files on the next scan. -->
	<arg name="cache"/>

	<!-- Show sniff codes in all reports. -->
	<arg value="s"/>

	<!-- Parallel processing. -->
	<arg name="parallel" value="50"/>

	<!-- WordPress Core currently supports PHP 8.2+. -->
	<config name="testVersion" value="8.2-8.3"/>

	<exclude-pattern>node_modules/*</exclude-pattern>
	<exclude-pattern>vendor/*</exclude-pattern>
	<exclude-pattern>build/*</exclude-pattern>
	<exclude-pattern>*.min.js</exclude-pattern>

	<arg name="extensions" value="php"/>
	<autoload>bootstrap.php</autoload>

	<!-- Include everything from the minimum set -->
	<rule ref="Linchpin-Minimum"/>

	<!-- Check for PHP cross-version compatibility. -->
	<rule ref="PHPCompatibilityWP"/>

	<rule ref="WordPress-Extra">
		<!-- Allow array short syntax. -->
		<exclude name="Universal.Arrays.DisallowShortArraySyntax.Found"/>
		<exclude name="Generic.Arrays.DisallowShortArraySyntax"/>
		<!-- Allow short prefixes. -->
		<exclude name="WordPress.NamingConventions.PrefixAllGlobals.ShortPrefixPassed"/>
		<exclude name="WordPress.NamingConventions.PrefixAllGlobals.NonPrefixedVariableFound"/>
		<!-- Exclude deprecated sniff -->
		<exclude name="Generic.Functions.CallTimePassByReference"/>
		<!-- Exclude filename rules -->
		<exclude name="WordPress.Files.FileName.NotHyphenatedLowercase"/>
		<exclude name="WordPress.Files.FileName.InvalidClassFileName"/>
		<!-- Exclude use statement rules -->
		<exclude name="Universal.UseStatements.DisallowUseClass.FromSameNamespace"/>
		<exclude name="Universal.UseStatements.DisallowUseFunction.FromSameNamespace"/>
		<exclude name="Universal.UseStatements.NoLeadingBackslash.LeadingBackslashFound"/>
		<!-- Allow with or without semicolons. -->
		<exclude name="Squiz.PHP.EmbeddedPhp.NoSemicolon"/>
		<!-- Exclude other conflicting rules. -->
		<exclude name="WordPress.Arrays.MultipleStatementAlignment.DoubleArrowNotAligned"/>
		<exclude name="WordPress.PHP.DevelopmentFunctions.error_log_trigger_error"/>
		<exclude name="Generic.Formatting.MultipleStatementAlignment.NotSameWarning"/>
		<!-- We like short arrays and ternaries around here -->
		<exclude name="WordPress.PHP.DisallowShortTernary"/>
		<!-- Exclude whitespace rules -->
		<exclude name="Generic.WhiteSpace.LanguageConstructSpacing"/>
	</rule>

	<!-- Require proper docblocks be used in all PHP files -->
	<rule ref="WordPress-Docs">
		<exclude name="Squiz.Commenting.FileComment.MissingPackageTag"/>
		<exclude name="Squiz.Commenting.FunctionComment.ParamCommentFullStop"/>
		<exclude name="Squiz.Commenting.FunctionComment.ThrowsNoFullStop"/>
		<exclude name="Squiz.Commenting.FunctionComment.SpacingAfterParamType"/>
	</rule>

	<!-- The minimum supported WordPress version. -->
	<rule ref="WordPress.WP.DeprecatedFunctions">
		<properties>
			<property name="minimum_wp_version" value="6.4"/>
		</properties>
	</rule>

	<!-- Prefer alignment over line length. -->
	<rule ref="WordPress.Arrays.MultipleStatementAlignment">
		<properties>
			<property name="maxColumn" value="1000"/>
		</properties>
	</rule>

	<!-- Allow . in hook names. -->
	<rule ref="WordPress.NamingConventions.ValidHookName">
		<properties>
			<property name="additionalWordDelimiters" value="."/>
		</properties>
	</rule>

	<!-- Ease up on the PHP DOM* objects. -->
	<rule ref="WordPress.NamingConventions.ValidVariableName">
		<properties>
			<property name="customPropertiesWhitelist" type="array">
				<!-- DOMDocument::$documentElement -->
				<element value="documentElement"/>
				<!-- DOMElement::$childElementCount -->
				<element value="childElementCount"/>
				<!-- DOMElement::$parentNode -->
				<element value="parentNode"/>
				<!-- DOMNode::$childNodes -->
				<element value="childNodes"/>
			</property>
		</properties>
	</rule>

	<rule ref="WordPress.Security.PluginMenuSlug"/>
	<rule ref="WordPress.Security.PluginMenuSlug.Using__FILE__">
		<type>error</type>
	</rule>

	<rule ref="WordPress.WP.CronInterval"/>
	<rule ref="WordPress.WP.CronInterval.CronSchedulesInterval">
		<type>error</type>
		<message>Scheduling crons at %s sec ( less than %s minutes ) is prohibited.</message>
	</rule>

	<!-- Allow for underscores in theme template file names -->
	<rule ref="WordPress.Files.FileName">
		<properties>
			<property name="is_theme" value="true"/>
		</properties>
	</rule>

	<!--
	Restore the ability to have multiple arguments per line

	WPCS disallowed this behavior in 1.1.0, but we'd like to keep it until
	there is a reason to disallow multiple arguments.
	Ref: https://github.com/WordPress-Coding-Standards/WordPress-Coding-Standards/commit/bb8a48671e213a5588a6439ea52411eeefab4b0f
	-->
	<rule ref="PEAR.Functions.FunctionCallSignature">
		<properties>
			<property name="allowMultipleArguments" value="true"/>
		</properties>
	</rule>
	<rule ref="PEAR.Functions.FunctionCallSignature.ContentAfterOpenBracket">
		<severity>0</severity>
	</rule>
	<rule ref="PEAR.Functions.FunctionCallSignature.CloseBracketLine">
		<severity>0</severity>
	</rule>

	<!--
	Linchpin Rules

	Based on WordPress Coding Standards with Linchpin customizations.
	-->
	<!-- Disallow long array syntax. -->
	<rule ref="Generic.Arrays.DisallowLongArraySyntax"/>
	<!-- Single statement on same line. -->
	<rule ref="Generic.Formatting.DisallowMultipleStatements"/>
	<!-- Namespacing required for classes. -->
	<rule ref="PSR1.Classes.ClassDeclaration"/>
	<!-- Declare symbols or run code, but not both. -->
	<rule ref="PSR1.Files.SideEffects"/>
	<!-- Namespacing required for functions. -->
	<rule ref="PSR2.Namespaces.NamespaceDeclaration"/>
	<!-- Namespacing of `use` statements. -->
	<rule ref="PSR2.Namespaces.UseDeclaration">
		<exclude name="PSR2.Namespaces.UseDeclaration.MultipleDeclarations"/>
	</rule>
	<rule ref="PSR2R.Namespaces.UnusedUseStatement"/>
	<rule ref="PSR2R.Namespaces.UseInAlphabeticalOrder"/>
	<!-- Ban inline assignment in control structures (see note on Yoda Conditions above). -->
	<rule ref="PSR2R.ControlStructures.NoInlineAssignment"/>
	<!-- Our custom empty line rule handles superfluous whitespace better -->
	<rule ref="Squiz.WhiteSpace.SuperfluousWhitespace">
		<exclude name="Squiz.WhiteSpace.SuperfluousWhitespace.EmptyLines"/>
	</rule>
	<!-- Allow multiple variable assignments, but only outside of conditionals -->
	<rule ref="Squiz.PHP.DisallowMultipleAssignments">
		<exclude name="Squiz.PHP.DisallowMultipleAssignments.Found"/>
	</rule>
</ruleset>
